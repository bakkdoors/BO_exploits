#!/usr/lib/python3

from boofuzz import *

host = '192.168.1.107'
port = 9999

# Title from Vulnserver
app_title = b"Welcome to Vulnerable Server! Enter HELP for help."


"""
I took this part from official dicumentation, written just to validate the correctness of the title specified 
in app_title = b"title" above | Everytime it connects it gives us welcome message "welcome to Vulnserver... 
until we can't receive it anymore due to the crash and stops the fuzzing 
"""


def get_title(target, my_logger, session, *args, **kwargs):
	try: 
		title = target.recv(1024)
	except:
		exit(1)
	if app_title in title:
		my_logger.log_pass('Title Received')
	else:
		my_logger.log_fail('No Title Received')
		exit(1)



# this part specifies the fuzzing itself

def main():
	session = Session(sleep_time=1, target = Target(connection=SocketConnection(host,port,proto='tcp')))

	s_initialize("FUZZING_NOW")

# Using TRUN command here
	s_string("TRUN", fuzzable = False)

# TRUN needs a space before an argument
	s_delim(" ", fuzzable = False, name = "Not Much Useful")

# Fuzzable Area	
	s_string("FUZZING_NOW")

	session.connect(s_get("FUZZING_NOW"), callback=get_title)
	session.fuzz()

if __name__ == "__main__":
	main()
